        SUBROUTINE BAGER (N,CA,CB,CC,SIMLT)CC		This routine has been modified 11/94 to provideC		lower case printing and to clean it up to compileC		with the MacFortran II compiler.CC       THIS DEALS WITH BAG RE-BREATHING, ETCC.        COMMON KT,KL,INI,NW1,NW2,JKL,IFLAG,NEOF,NW        COMMON NFLAG,J3,ISPAR,NA,NB,NC,ND,NE(8)        COMMON NARTI,MT,K2,K4,INDEX        COMMON FIO2,FIC2,T1(4),VLUNG,T2(5),BARPR,     /	TEMP,T3(22),BAGO,BAGC,AO2MT,AC2MT,     /	T4(6),TIDVL,RRATE,T5(21),DSPAC,REFLV,T6(7),QB,PW,     /	FT,T7(17),AVENT,PL,T8(12),QA,T9(2),BAG        GO TO (100,430,430,440,500,510,230), N100     IF (NW2.GT.19) GO TO 120CC		I have modified the code here to use a differentC		writing format.  The old code is left in caseC		this method fails.  11/27/94C		WRITE (*,*) 'Do you want to make your subject '		WRITE (*,*) '  1.  Obstruct the glottis'		WRITE (*,*) '  2.  Collect expired air in a bag'		WRITE (*,*) '  3.  Rebreath from a bag'		WRITE (*,*) '  4.  Same, with CO2 absorber in circuit'		WRITE (*,*) '  5.  Restore: breathing air, no bag, glottis open'CC        WRITE (*," DO YOU WANT TO MAKE YOUR SUBJECT ")C        WRITE (*,'   1. OBSTRUCT THE GLOTTIS')C        WRITE (*,'   2. COLLECT EXPIRED AIR IN A BAG')C        WRITE (*,'   3. REBREATH FROM A BAG')C        WRITE (*,'   4. SAME, WITH CO2 ABSORBER IN CIRCUIT')C        WRITE (*,'   5. RESTORE:BREATHING AIR,NO BAG, GLOTTIS OPEN')        NW2=0120     CALL NXTWD (7,XXX,NNN,1,5)        PL=0.        GO TO (410,150,140,130,170),  NNN130     PL=PL+1.140     PL=PL+1.150     PL=PL+1.        IF (NNN-2) 160,160,200160     BAG=.00001        BAGO=.00000011        GOTO 300C       RESTORE ALL TO NORMAL, BAG UNCHANGED170     VLUNG=REFLV        FIO2=20.93        FIC2=0.03        WRITE (*,180)180     FORMAT ('Glottis open -- Bag disconnected -- Breathing air')190     RETURNC       BAG REBREATHING OPTIONS200     IF (NW2.GT.19) GO TO 220        NW2=0        WRITE (*,210)210		FORMAT ('Do you want  1.  100% oxygen, 2.  a gas mixture, 3.  carry on with old bag?')220     CALL NXTWD (7,XXX,NNNN,1,3)C       SET BTPS STPD CORRECTIONS230     X=BARPR/SIMLT-1.2703*TEMP        CORR=(273.+TEMP)/(X*.3592)        IF (N-7) 240,530,240240     IF (NNNN-3) 250,390,250250     IF (NW2.GT.19) GO TO 280        NW2=0260     WRITE (*,270)270		FORMAT(' Give initial gas volume in bag, in cc (BTPS)')280     CALL NXTWD(7,BAG,NN,300,30000)        IF (NNNN-2) 290,310,390290     BAGO=BAG/CORR300     BAGC=.0000001        GO TO 390310     IF (NW2.GT.19) GO TO 330        NW2=0        WRITE (*,320)320     FORMAT('Specify per cent CO2')330     CALL NXTWD(7,BAGC,NNN,0,100)        IF (NW2.GT.19) GO TO 350        NW2=0        WRITE (*,340)340     FORMAT('Now per cent oxygen')350     CALL NXTWD(7,BAGO,NNN,0,100)        X=BAGO+BAGC        IF (X-100.) 380,380,360360     WRITE (*,370)370     FORMAT ('Ridiculous - try again')        GO TO 310380     X=BAG*.01/CORR        BAGO=BAGO*X        BAGC=BAGC*X390     X=CORR*100./BAG        XXX=BAGO*X        X=BAGC*XC        WRITE (*,400) BAG,XXX,XC 400	FORMAT(' VOL ',F7.0,' CC BAG, CONTAINS ',F6.1,'% O2 + ',F6.1,'% CO2')        RETURNC       GLOTTIS CLOSED, STORE INITIAL VOLUME FOR REFERENCE410     WRITE (*,420)420     FORMAT('Glottis stays closed until factor 100 changed again')        REFLV=VLUNG        PL=-1.        RETURNC       SET INSPIRED GAS EQUAL TO MIX IN BAG430     X=1./(BAG*CC+.00001)        FIO2=BAGO*X        FIC2=BAGC*X        IF (PL.GT.2.5) FIC2=0.        RETURNC       DSPVT IS GAS IN UPPER AIRWAYS BREATHED INTO BAGC       TEST IF TIDAL VOL. GREATER THAN BAG VOLUME440     IF (PL.GT.1.) GO TO 450C       NEXT SECTION FOR BAG COLLECTION ONLY        X=DSPAC*RRATE*FT        BAG=BAG+CA+X        X=X*CC        BAGO=BAGO+CB*AO2MT+FIO2*X        BAGC=BAGC+CB*AC2MT+FIC2*X        RETURNC       TEST IF TIDAL VOLUME GREATER THAN BAG450     IF (BAG.GT.TIDVL) GO TO 470        WRITE (*,460)460     FORMAT('***** Tidal volume too big for bag size *****')        CB=-10000.        RETURN470     IF (PL.LT.2.5) GO TO 480        BAG=BAG-AC2MT*.01/CC        BAGC=0.        GO TO 490C       THIS SECTION SKIPPED IF CO2 ABSORBER IN CIRCUIT480     BAGC=BAGC+QB490     BAGO=BAGO-QA        BAG=BAG-AVENT+CA        RETURN500     VLUNG=CA*.01/CC        RETURN510     WRITE (*,520) VLUNG520     FORMAT (' Lung volume = ',F6.0,' CC (BTPS)')        RETURNC       DISPLAY SECTION FOR INSPECT TABLE IN DEADY530     IF (BAG.LT..0001) BAG=.0001        X=X*(273.+TEMP)/(273.*BAG)        BAGP=BAGC*X*SIMLT        BAGPO=BAGO*X*SIMLT        XNMT=BAG/CORR-BAGO-BAGC        WRITE (*,540) BAGPO,BAGP,BAGO,BAGC,XNMT,BAG540     FORMAT ('BAG.',F7.1,F8.1,16X,F8.0,F8.0,' *N2=',F7.0,     //,' * BAG VOL.',F7.0,' (BTPS)')        RETURN        END